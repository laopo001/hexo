---
title: go笔记
slug: gobi-ji
date_published: 1970-01-01T00:00:00.000Z
date_updated: 2017-03-09T10:08:48.000Z
draft: true
---

    package main
    
    import (
    	"fmt"
    	"io/ioutil"
    	"net/http"
    	"os"
    	"regexp"
    	"github.com/urfave/cli"
    	"golang.org/x/net/proxy"
    )
    
    var (
    	url = regexp.MustCompile(`<cite class="_Rm">.+?</cite>`)
    )
    
    func checkFileIsExist(filename string) bool {
    	var exist = true
    	if _, err := os.Stat(filename); os.IsNotExist(err) {
    		exist = false
    	}
    	return exist
    }
    
    func Get(url,ip,port string) (content string, statusCode int) {
    	dialer, err := proxy.SOCKS5("tcp", ip+":"+port, nil, proxy.Direct)
    	if err != nil {
    		fmt.Fprintln(os.Stderr, "can't connect to the proxy:", err)
    		os.Exit(1)
    	}
    	// setup a http client
    	httpTransport := &http.Transport{}
    	client := &http.Client{Transport: httpTransport}
    	// set our socks5 as the dialer
    	httpTransport.Dial = dialer.Dial
    
    	req, _ := http.NewRequest("GET", url, nil)
    	req.Header.Set("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36")
    	//	client := http.DefaultClient
    	res, error := client.Do(req)
    	if error != nil {
    		fmt.Errorf("Get请求%s返回错误:%s", url, error)
    		return
    	}
    	statusCode = res.StatusCode
    	if res.StatusCode == 200 {
    		body := res.Body
    		defer body.Close()
    		bodyByte, _ := ioutil.ReadAll(body)
    		content = string(bodyByte)
    	} else {
    		content = ""
    	}
    	return
    }
    
    func run(ip,port,q,num string) {
    	fmt.Println(`Start...`)
    	s, _ := Get("https://www.google.com.hk/search?q="+q+"&num="+num,ip,port,)
    	var f *os.File
    	var filename = "./output.txt"
    	// if checkFileIsExist(filename) { //如果文件存在
    	// 	f, _ = os.OpenFile(filename, os.O_APPEND, 0666) //打开文件
    	// 	fmt.Println("文件存在")
    	// } else {
    	// 	f, _ = os.Create(filename) //创建文件
    	// 	fmt.Println("文件不存在")
    	// }
    
    	strArr := url.FindAllString(s, -1)
    	//	fmt.Printf("%q\n",strArr)
    	// reg1 := regexp.MustCompile(`(?P<q>Hell|G)o`)
    	// fmt.Printf("%q\n", reg1.ReplaceAllString("Hello 世界！123 Go", "${q}ooo"))
    	str := ""
    	reg := regexp.MustCompile(`(<cite class="_Rm">|</cite>)`)
    	for i := 0; i < len(strArr); i++ {
    	//	fmt.Printf("%q\n", reg.ReplaceAllString(strArr[i], "${1}"))
    		str += reg.ReplaceAllString(strArr[i], "") + "\r\n"
    	}
    	//str+=s
    	f, _ = os.Create(filename)
    	defer f.Close()
    	n, _ := f.WriteString(str) //写入文件(字符串)
    	fmt.Printf("写入 %d 个字节n", n)
    	f.Sync()
    	//	fmt.Println(s)
    }
    
    func main() {
     app := cli.NewApp()
     var ip string
     var port string
     var num string
    
      app.Flags = []cli.Flag {
        cli.StringFlag{
          Name: "ip",
          Value: "127.0.0.1",
          Usage: "SOCKS5代理地址",
    	  Destination: &ip,
        },cli.StringFlag{
          Name: "port,P",
          Value: "3333",
          Usage: "SOCKS5代理端口",
    	  Destination: &port,
        },cli.StringFlag{
          Name: "num,N",
          Value: "100",
          Usage: "搜索条数",
    	  Destination: &num,
        },
      }
    
      app.Action = func(c *cli.Context) error {
        q := ""
        if c.NArg() > 0 {
          q = c.Args().Get(0)
        }else{
    		 fmt.Println("请输入搜索关键字,如搜索1234 Get.exe 1234\r\nGet.exe -h,查看帮助")
    		 return nil
    	}
    	run(ip,port,q,num)
        return nil
      }
    
      app.Run(os.Args)
    }
    
